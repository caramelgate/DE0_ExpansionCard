JAPANESE 日本語(UTF-8)

DE0拡張基板 DE0EC8のデバッグ情報

2013年2月4日

発注した基板がまもなく到着。しかし、だ。不具合に気付いてしまった。
アルテラのCycloneはFPGA内部でPLLのカスケードができないのを忘れていた。
仕方がないので、OSCが載っている基板の配線を変更してPLLをフィードバックしよう。
修正の方針はDE0EC8_DEBUGのような感じ。

欲しい周波数はNTSCの3.57MHz。
27MHzからは以下の計算でPPMの誤差しか出ない。

27MHz*5*7/3/11 =28.63MHz =8fsc(NTSC)

実際に使うのは15fsc=53.69MHzとそれを7分周した7.67MHz。
50MHzからは以下の計算で出てくる。
DE0に搭載のCyclone3なら、PLLを2段で作成可能。

50MHz*3*7/4/11=23.86MHz 23.86MHz*9/4=53.69MHz

いきなり基板の修正を始めるのはアレなので、代わりに54MHzを作ってデバッグを進める。
ちなみに15fscはメガドラ兄さんの腹時計。

2013年2月5日

基板到着。
製造はハッピーPCBに依頼。
http://www.happypcb.com/store/

DE0EC8-1基板(仮 シリアル)とDE0EC8-2基板(仮 ビデオ)の仮組画像。
開封 P1000100.jpg
PCB P1000101.jpg
前方 P1000102.jpg
後方 P1000103.jpg
上方 P1000104.jpg

ビデオ基板の穴位置は採寸がいまいち間違ってたので、DE0に取り付けるとずれる。対策は4mmぐらいに拡張？
シリアル基板の7セグの切り欠きはいまいちなんだけど、いじるとビデオ基板に影響が出るんだよな。
DE0のLEDも斜め前から見えるから問題なし。

2013年2月6日

いまのところ作った基板に泣きたくなる間違いはなさそう。
デバッグ情報を反映する基板の名前はDE0EC8Aにする。

ます、PLLフィードバックの配線は変更しておく。
こうなると基板に部品を実装するときには修正情報を反映しなきゃならんな。

穴位置を合わせるためにビデオ基板のGPIO1コネクタを0.23mm移動。5milグリッドにあわせてみる。
シリアル基板の穴位置を調整するので外形を107.77mmから107.5mmに変更。穴位置は103.5mmから103.3mmに移動。
基板ガイドの7セグが大きいので小さくする。

ビデオ基板シルク "IC10"の位置がまずい。全然気が付かなかった。表面だから目立つ。
ビデオ基板シルク "SV4"のサイズがそろっていない。
ビデオ基板シルク "DE0EC8-2"は表(作画は半田面)へ移動したほうがよさそう？
シリアル基板シルク "DEVICE1"と"R42"～"R45"がドリルで欠けてる。

2013年2月10日

実装を始めるために部品を確認する。
R68 HPDプルダウンは22kを2.2kに修正。

2013年2月11日

QFN48(IC10)の1番マークを忘れていた。シルクを追加。
PLL用の配線はSV4を捨てれば改修が楽そう。基板を切らないといけないのが少し悲しい。
USB-SERIAL FT230XをQFNで頼んでしまった。次の機会に調達することにしよう。
集合抵抗を付けてみた。久しぶりなので端子ブリッジ。0.5mmはめんどい。

2013年2月16日

ICを実装してみる。QFNは挫折した。コネクタは仮設。
デバッグ用にSW8個の基板を作る。

途中経過の画像を追加。
経過 P1000121.jpg

2013年2月17日

姉妹機 MBECの実装ができたというので受け取る。
ちなみに設計はMBECのほうが先。データの公開場所は未定。

MBECの画像を追加。同時期の設計なのでそれなり似てるんではないかい？
PS/2コネクタが緑なのはDE0と同じく基板色、ではなく安く買えたから。
裏面 P1000125.jpg
表面 P1000127.jpg

2013年2月18日

デバッグ用のスイッチ基板とシリアル変換基板の回路図を追加。
デバッグ環境用にOpenCoresのTG68(68K互換CPU)とMECB(MC68000 Educational Computer Board)を動かす。
MECBのコンソールはDE0本体のシリアルポートを使い、ボーレートは19200-8N1。フロー制御なし。
もし流用するときは自前の環境にあわせてシリアルポートの接続を設定して合成しよう。

MECBは68Kを搭載したワンボードコンピューター。
TUTORとよばれるROMが載っており、ソースコードはMotorola's FREEWARE BBSで配布されていたんだとか。

68K(TG68)は7.7MHzで動作。TUTORはFPGA内蔵RAMに格納。
Cyclone3の内蔵RAMは別用途でも使うので、MECBに載っている32KバイトのRAMはSDRAMを使用。
ちなみにSDRAMコントローラーはセオリーではない作りになっている。25周年に向けた暫定仕様。
詳しい構成はそのうち書こうと思う。ついでに素の状態を分離しておいた方がよいか。


2013年4月09日

デバッグ情報を反映させた回路図 DE0EC8_DEBUG_sch.pdfと差しかえ。

DAC用の74VHC245は閾値が70%なので3.3V -> 5Vの電圧ドライバーには使えないため、代わりに74VHCT245を載せること。
そのほか、抵抗値など変更。

TMDSドライバーのQFNパッケージは半田付けが全部失敗したので、かわりにDisplayPortの変換ドングルをつかって動作確認する。

最新版 DE0EC8A と差しかえ。

デバッグ情報追加。

○ イーサネットのテスト : Nios2でuClinuxを動かしてDHCPクライアントでIPアドレスを取得する
○ SDカードのテスト : ChaNさん作成のFatFsを移植してSDカードの内容を読み出す
○ OPTICAL-IN/OUT,DACのテスト : OPTICAL-INからSPDIF信号を入力し、ΔΣDACでオーディオ信号に変換する
○ DVI,USBのテスト : 640x480 VGA解像度を表示する

