//-----------------------------------------------------------------------------
//
//  25DRV (quarter drive) : megadrive and genesis 25th anniversary project
//
//  LICENSE : as-is
//  copyright (C) 2013, TakeshiNagashima caramelgate@gmail.com
//------------------------------------------------------------------------------
//  2013/dec/23 release 0.1  preview
//
//------------------------------------------------------------------------------
//
//  original and related project
//
//  fpgagen : fpgagen (googlecode) license new-bsd
//  TG68 : TG68 (opencores) license LGPL
//  T80 : T80 (opencores) license as-is
//  sn76489 : fpga_colecovison (fpga arcade) license GPL2
//
//------------------------------------------------------------------------------

25DRVは、googlecodeに登録されているfpgagenをVerilogで書き直し、TERASIC DE0およびDigilent Nexys3で動くようにしたものです。
メガドライブおよびGENESISの２５周年記念として公開します。

３０周年ではぜひともギガドライブをやってみたいところです。

fpgagenをいろいろと書き直しているので、ライセンスはファイル単位で異なります。

○最重要な

fpgagenはMAMEなどのソフトウエアエミュレーターを元に作られたと推測されます。
そのため、ハードウエア的には非効率な実装となっているところがあります。
また、記憶にある実機の中身と異なる部分については、気が向いたら書き直してあります。

サンダーフォース４が動きます。
忍２が動きます。
モナコGPが動きます。
アウトランは動きません。DMA(CRAM)の修正が必要です。
ベアナックル３は動きません。Z80？ FM音源？

DE0は配線リソースが不足気味です。コードを追加すると動作不能になることがあります。
Nexys3はコンパイル時にリソースが100%を超えることがありますが、最終的には収まるので問題なしです。
根本から書き直せばリソースの問題はなくなりそうですが、FM音源を追加するとなるとまた足りなくなる？


○ 重要な

VHDLからVerilogに書き換えました。

内蔵メモリなど、デバイス依存を分離しました。
最上位のparameterでデバイス指定を行うと、下位ファイルにオーバーライドします。

コレコビジョンのPSG(PSA SN76489)を追加しました。
実機はウエイトが発生しない互換回路なので、書き直す必要があります。
FM音源のレジスタを実装しました。DAのみ対応します。
ゲームではPSGドラムとサンプリングボイスが出ます。

メモリコントローラーとアービターを追加しました。
DE0とNexys3のために、SDRAMとCellulaur RAM(同期PSRAM)のコントローラーを用意しました。
MIGのようなインターフェースとしたので、DDRメモリに差しかえるのも可能でしょう。

スプライトジェネレーターは50%の完成度です。
スクロールジェネレーターは50%の完成度です。
レンダリングエンジンをパイプライン処理に書き換えて高速化する必要があります。

DMAエンジンは10%の完成度です。
SCRAMの転送開始を直しました。
CRAMの転送開始は修正が必要です。
ライトコンバインを行う必要があります。書き込み処理が非常に低速です。
不連続転送を実装していません。


○無保証な

PC-8001のkwhrさんがつくられたUSB-HIDのホストを改造して、USB PADを使えるようにしてみました。
現状では特定のUSB PADだけ対応します。

さらなる互換度を目指すなら、以下のファイルを探してみましょう。

Genesis_OS_ROM.zip
genesis_technical_overview.zip 
sega-snd.zip

カートリッジROMはFLASHメモリを使います。
書き込みはDE0EC8-PFLで行います。

画面の上下に出ているのは、デバッグ用のスケールです。

